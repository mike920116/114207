{% extends "base.html" %}

{% block title %}å¥½å‹è«‹æ±‚ç®¡ç† | æ—¥è¨˜ä¹‹æ£®{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/modules/coopcard/friend_requests.css') }}">
{% endblock %}

{% block content %}
<div class="friend-requests-wrapper">
  <div class="page-header">
  <a href="{{ url_for('coopcard.coopcard_main') }}" class="back-btn">â® è¿”å›ä»»å‹™å¡ç‰‡</a>
    <h1 class="page-title">
      <span class="page-emoji">ğŸ“¨</span>
      å¥½å‹è«‹æ±‚ç®¡ç†
    </h1>
  </div>

  <div class="requests-content">
    <!-- æ”¶åˆ°çš„è«‹æ±‚ -->
    <div class="requests-section">
      <h2 class="section-title">
        <span class="section-emoji">ğŸ“¥</span>
        æ”¶åˆ°çš„è«‹æ±‚ ({{ incoming_requests|length }})
      </h2>
      
      {% if incoming_requests %}
      <div class="requests-list">
        {% for request in incoming_requests %}
        <div class="request-item incoming" data-request-id="{{ request[0] }}">
          <div class="user-avatar">
            <img src="{{ request[3] or '/static/icons/avatars/default.png' }}" alt="é ­åƒ">
          </div>
          <div class="request-info">
            <h4 class="user-name">{{ request[2] }}</h4>
            <p class="user-email">{{ request[1] }}</p>
            <span class="request-time">{{ request[4].strftime('%Y-%m-%d %H:%M') if request[4] else '' }}</span>
          </div>
          <div class="request-actions">
            <button class="action-btn accept-btn" onclick="respondRequest({{ request[0] }}, 'accept')">
              <span class="btn-emoji">âœ…</span>
              æ¥å—
            </button>
            <button class="action-btn reject-btn" onclick="respondRequest({{ request[0] }}, 'reject')">
              <span class="btn-emoji">âŒ</span>
              æ‹’çµ•
            </button>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="empty-state">
        <div class="empty-icon">ğŸ“­</div>
        <h3>ç›®å‰æ²’æœ‰å¾…è™•ç†çš„å¥½å‹è«‹æ±‚</h3>
        <p>ç•¶æœ‰äººç™¼é€å¥½å‹è«‹æ±‚æ™‚ï¼Œæœƒé¡¯ç¤ºåœ¨é€™è£¡</p>
      </div>
      {% endif %}
    </div>

    <!-- ç™¼é€çš„è«‹æ±‚ -->
    <div class="requests-section">
      <h2 class="section-title">
        <span class="section-emoji">ğŸ“¤</span>
        ç™¼é€çš„è«‹æ±‚ ({{ outgoing_requests|length }})
      </h2>
      
      {% if outgoing_requests %}
      <div class="requests-list">
        {% for request in outgoing_requests %}
        <div class="request-item outgoing status-{{ request[4] }}">
          <div class="user-avatar">
            <img src="{{ request[3] or '/static/icons/avatars/default.png' }}" alt="é ­åƒ">
          </div>
          <div class="request-info">
            <h4 class="user-name">{{ request[2] }}</h4>
            <p class="user-email">{{ request[1] }}</p>
            <span class="request-time">{{ request[5].strftime('%Y-%m-%d %H:%M') if request[5] else '' }}</span>
          </div>
          <div class="request-status">
            {% if request[4] == 'pending' %}
            <span class="status-badge pending">
              <span class="status-emoji">â³</span>
              ç­‰å¾…å›æ‡‰
            </span>
            {% elif request[4] == 'accepted' %}
            <span class="status-badge accepted">
              <span class="status-emoji">âœ…</span>
              å·²æ¥å—
            </span>
            {% elif request[4] == 'rejected' %}
            <span class="status-badge rejected">
              <span class="status-emoji">âŒ</span>
              å·²æ‹’çµ•
            </span>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="empty-state">
        <div class="empty-icon">ğŸ“®</div>
        <h3>å°šæœªç™¼é€ä»»ä½•å¥½å‹è«‹æ±‚</h3>
        <p>ä½¿ç”¨æœå°‹åŠŸèƒ½æ‰¾åˆ°æœ‹å‹ä¸¦ç™¼é€è«‹æ±‚</p>
        <a href="{{ url_for('coopcard.coopcard_main') }}" class="empty-action-btn">é–‹å§‹æœå°‹å¥½å‹</a>
      </div>
      {% endif %}
    </div>
  </div>
</div>

<!-- æ“ä½œç¢ºèªæ¨¡æ…‹æ¡† -->
<div id="confirm-modal" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="confirm-title">ç¢ºèªæ“ä½œ</h3>
    </div>
    <div class="modal-body">
      <p id="confirm-message">ç¢ºå®šè¦åŸ·è¡Œæ­¤æ“ä½œå—ï¼Ÿ</p>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeConfirmModal()">å–æ¶ˆ</button>
      <button class="btn btn-primary" id="confirm-btn" onclick="executeAction()">ç¢ºèª</button>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/modules/coopcard/friend_requests.js') }}"></script>
{% endblock %}