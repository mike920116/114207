{% extends 'base.html' %}

{% block title %}å›é¥‹æ­·å² - æ”¯æ´ä¸­å¿ƒ{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/modules/support/report.css') }}">
{% endblock %}

{% block content %}
<div class="support-wrapper">
  <div class="support-container">
    <!-- é é¢æ¨™é¡Œ -->
    <div class="page-header">
      <h1 class="page-title">æˆ‘çš„å›é¥‹æ­·å²</h1>
      <p class="page-subtitle">æŸ¥çœ‹æ‚¨æäº¤çš„æ‰€æœ‰å›é¥‹è¨˜éŒ„åŠè™•ç†ç‹€æ…‹</p>
    </div>

    <!-- æ“ä½œåˆ— -->
    <div class="action-bar">
      <a href="{{ url_for('support.report_form') }}" class="btn btn-primary">
        <i class="icon-plus"></i> æ–°å¢å»ºè­°
      </a>
    </div>

    <!-- èˆ‰å ±åˆ—è¡¨ -->
    {% if reports %}
    <div class="reports-list">
      {% for report in reports %}
      <div class="report-card {{ 'status-' + report.status }}">
        <div class="report-header">
          <div class="report-title">
            <h3>{{ report.theme }}</h3>
            <div class="report-meta">
              <span class="report-date">{{ report.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
              {% if report.updated_at != report.created_at %}
              <span class="report-updated">æ›´æ–°ï¼š{{ report.updated_at.strftime('%Y-%m-%d %H:%M') }}</span>
              {% endif %}
            </div>
          </div>
          <div class="report-status">
            <span class="status-badge status-{{ report.status }}">
              {% if report.status == 'pending' %}å¾…è™•ç†
              {% elif report.status == 'accepted' %}å·²æ¥å—
              {% elif report.status == 'rejected' %}å·²æ‹’çµ•
              {% elif report.status == 'closed' %}å·²é—œé–‰
              {% endif %}
            </span>
          </div>
        </div>

        <div class="report-content">
          <div class="report-types">
            <strong>é¡å‹ï¼š</strong>
            {% for option in report.options %}
            <span class="type-tag">{{ option }}</span>
            {% endfor %}
          </div>

          <div class="report-description">
            <strong>èªªæ˜ï¼š</strong>
            <p>{{ report.context[:150] }}{% if report.context|length > 150 %}...{% endif %}</p>
          </div>

          <!-- ç®¡ç†å“¡å›è¦† -->
          {% if report.staff_reply %}
          <div class="staff-reply">
            <strong>ç®¡ç†å“¡å›è¦†ï¼š</strong>
            <div class="reply-content">{{ report.staff_reply }}</div>
          </div>
          {% endif %}
        </div>

        <div class="report-actions">
          <a href="{{ url_for('support.report_detail', report_id=report.report_id) }}" 
             class="btn btn-sm btn-outline">æŸ¥çœ‹è©³æƒ…</a>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <!-- ç©ºç‹€æ…‹ -->
    <div class="empty-state">
      <div class="empty-icon">ğŸ“</div>
      <h3>é‚„æ²’æœ‰å›é¥‹è¨˜éŒ„</h3>
      <p>é‡åˆ°å•é¡Œæˆ–æœ‰å»ºè­°å—ï¼Ÿé»æ“Šä¸‹æ–¹æŒ‰éˆ•æäº¤æ‚¨çš„ç¬¬ä¸€å€‹å›é¥‹</p>
      <a href="{{ url_for('support.report_form') }}" class="btn btn-primary">æäº¤æ„è¦‹</a>
    </div>

    {% endif %}
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/modules/support/report.js') }}"></script>
{% endblock %}
